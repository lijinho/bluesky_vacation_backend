app.controller("verify_phone",["$scope","$http",function(e,n){e.users_phone_numbers=[],e.phone_number_val=[],e.phone_code_val=[],e.otp_val=[];var s=$("#phone_numbers_wrapper");$(document).ready(function(){n.post(e.fetch_url,{}).then(function(n){e.users_phone_numbers=[];var s=null,u=null;angular.forEach(n.data,function(n,r){"Confirmed"==n.status?e.phone_verified=!0:"Pending"==n.status&&null==s?s=r:"Null"==n.status&&null==u&&(u=r)}),e.phone_verified||null!=s||null!=u?null!=s?(e.users_phone_numbers[0]=n.data[s],e.should_add_phone=!1):null!=u&&(e.users_phone_numbers[0]=n.data[u],e.phone_number_val[0]=e.users_phone_numbers[0].phone_number,e.should_add_phone=!1):(e.add_phone_number(),e.should_add_phone=!1)})}),e.add_phone_number=function(){s.addClass("loading"),new_phone_number={id:"",phone_number:"2015555555",phone_code:e.default_phone_code,status:"Null"},e.users_phone_numbers.push(new_phone_number),$(".add-phn").addClass("hide"),s.removeClass("loading")},e.update_phone_number=function(u){if($('input[name="phone_number'+u+'"]').intlTelInput("isValidNumber")){var r=e.phone_number_val[u],o=$('input[name="phone_number'+u+'"]').closest(".intl-tel-input").find(".country-list li.active").data("country-code"),_=e.users_phone_numbers[u].id;s.addClass("loading"),n.post(e.update_url,{id:_,phone_number:r,country_name:o}).then(function(n){"Success"===n.data.status?(e.users_phone_numbers[u].phone_number_error="",e.users_phone_numbers=n.data.users_phone_numbers,e.phone_number_val[u]=""):e.users_phone_numbers[u].phone_number_error=n.data.message,s.removeClass("loading"),e.should_add_phone=!1})}},e.verify_phone_number=function(u){s.addClass("loading"),phone_number=e.users_phone_numbers[u],otp_val=e.otp_val[u]?e.otp_val[u]:"",n.post(e.verify_url,{otp:otp_val,id:phone_number.id}).then(function(n){"Success"===n.data.status?(e.users_phone_numbers[u].otp_error="",e.users_phone_numbers=n.data.users_phone_numbers,e.otp_val[u]="",e.phone_verified=!0):e.users_phone_numbers[u].otp_error=n.data.message,s.removeClass("loading"),document.getElementsByClassName("err-phone-verify").length>0&&"Success"===n.data.status&&$(".err-phone-verify").addClass("hide")})},e.remove_phone_number=function(u){s.addClass("loading"),phone_number=e.users_phone_numbers[u],n.post(e.remove_url,{id:phone_number.id}).then(function(n){"Success"===n.data.status?(e.users_phone_numbers[u].phone_number_error="",e.users_phone_numbers=n.data.users_phone_numbers):e.users_phone_numbers[u].phone_number_error=n.data.message,s.removeClass("loading"),$(".add-phn").removeClass("hide");var r=null,o=null;angular.forEach(n.data.users_phone_numbers,function(e,n){"Pending"==e.status&&null==r?r=n:"Null"==e.status&&null==o&&(o=n)}),null==r&&null==o?e.should_add_phone=!0:null!=r?(e.users_phone_numbers[0]=n.data.users_phone_numbers[r],e.should_add_phone=!1):null!=o&&(e.users_phone_numbers[0]=n.data.users_phone_numbers[o],e.phone_number_val[0]=e.users_phone_numbers[0].phone_number,e.should_add_phone=!1)})}}]);
