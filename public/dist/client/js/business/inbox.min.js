var daterangepicker_format=$('meta[name="daterangepicker_format"]').attr("content"),datepicker_format=$('meta[name="datepicker_format"]').attr("content");app.directive("postsPagination",function(){return{restrict:"E",template:'<ul class="pagination"><li ng-show="currentPage != 1"><a href="javascript:void(0)" ng-click="messages_result(1)">&laquo;</a></li><li ng-show="currentPage != 1"><a href="javascript:void(0)" ng-click="messages_result(currentPage-1)">&lsaquo; '+$("#pagin_prev").val()+' </a></li><li ng-repeat="i in range" ng-class="{active : currentPage == i}"><a href="javascript:void(0)" ng-click="messages_result(i)">{{i}}</a></li><li ng-show="currentPage != totalPages"><a href="javascript:void(0)" ng-click="messages_result(currentPage+1)"> '+$("#pagin_next").val()+' &rsaquo;</a></li><li ng-show="currentPage != totalPages"><a href="javascript:void(0)" ng-click="messages_result(totalPages)">&raquo;</a></li></ul>'}}).controller("inbox",["$scope","$http",function(a,e){a.today=new Date,setTimeout(function(){a.totalPages=0,a.currentPage=1,a.range=[],pageNumber=1,void 0===pageNumber&&(pageNumber="1");var t=$("#inbox_filter_select").val(),i=a.user_id;e.post("inbox/message_by_type",{data:i,type:t}).then(function(e){a.message_result=e.data,a.totalPages=e.data.last_page,a.currentPage=e.data.current_page;for(var t=[],i=1;i<=e.data.last_page;i++)t.push(i);a.range=t}),e.post("inbox/message_count",{data:i,type:t}).then(function(e){a.message_count=e.data}),a.messages_result=function(t){void 0===t&&(t="1");var i=$("#inbox_filter_select").val(),n=a.user_id;e.post("inbox/message_by_type?page="+t,{data:n,type:i}).then(function(e){a.message_result=e.data,a.totalPages=e.data.last_page,a.currentPage=e.data.current_page;for(var t=[],i=1;i<=e.data.last_page;i++)t.push(i);a.range=t})},a.archive=function(t,n,r,s){e.post("inbox/archive",{id:n,msg_id:r,type:s}).then(function(n){"Archive"==s&&(a.message_result.data[t].archive=1),"Unarchive"==s&&(a.message_result.data[t].archive=0),e.post("inbox/message_count",{data:i,type:s}).then(function(e){a.message_count=e.data})})},a.star=function(t,n,r,s){e.post("inbox/star",{id:n,msg_id:r,type:s}).then(function(n){"Star"==s&&(a.message_result.data[t].star=1),"Unstar"==s&&(a.message_result.data[t].star=0),e.post("inbox/message_count",{data:i,type:s}).then(function(e){a.message_count=e.data})})},$("#inbox_filter_select").change(function(){var t=this.value,i=a.user_id;e.post("inbox/message_by_type",{data:i,type:t}).then(function(n){a.message_result=n.data,a.totalPages=n.data.last_page,a.currentPage=n.data.current_page;for(var r=[],s=1;s<=n.data.last_page;s++)r.push(s);a.range=r,e.post("inbox/message_count",{data:i,type:t}).then(function(e){a.message_count=e.data})})})},10)}]),app.controller("conversation",["$scope","$http",function(a,e){function t(a,t,i,n){$(".special-offer-date-fields").addClass("loading");var r=[];e.post("../../rooms/price_calculation",{checkin:t,checkout:a,guest_count:i,guest_options:r,room_id:n}).then(function(a){$(".special-offer-date-fields").removeClass("loading"),"Not available"==a.data.status?(""!=a.data.error?($("#availability_warning #error").text(a.data.error),$("#availability_warning #not_available").addClass("hide"),$("#availability_warning #error").removeClass("hide")):($("#availability_warning #error").addClass("hide"),$("#availability_warning #error").text(""),$("#availability_warning #not_available").removeClass("hide")),$("#availability_warning").removeClass("hide")):$("#availability_warning").addClass("hide"),$("#pricing_price").val(a.data.subtotal),$("#availability_status").val(a.data.status)})}function i(a){var i=a;$(".special-offer-date-fields").addClass("loading"),e.post("../../rooms/rooms_calendar",{data:i}).then(function(a){var e=$('input[name="pricing[start_date]"]').val(),i=$('input[name="pricing[end_date]"]').val(),n=$("#pricing_guests").val(),r=$("#pricing_room_id").val();""!=e&&t(i,e,n,r)})}a.calculation_status="",$(document).on("input",'textarea[name="message"]',function(){""==$(this).val()?($(this).siblings(".ml-error").html("Message content is required!."),$(this).addClass("invalid")):($(this).siblings(".ml-error").html(""),$(this).removeClass("invalid"))}),a.reply_message=function(a){var t=$('[data-key="'+a+'"] textarea[name="message"]').val();if(""==t)return $('[data-key="'+a+'"] .ml-error').html("Message content is required!."),$('[data-key="'+a+'"] textarea[name="message"]').addClass("invalid"),!1;var i=$('[data-key="'+a+'"] input[name="template"]').val();if(2==i){if(""==$("#pricing_start_date").val()||""==$("#pricing_end_date").val())return $("#availability_warning").removeClass("hide"),"";if(""==$("#pricing_price").val())return $("#availability_warning1").removeClass("hide"),"";$("#availability_warning").addClass("hide"),$("#availability_warning1").addClass("hide")}e.post(APP_URL+"/messaging/qt_reply/"+$("#reservation_id").val(),{message:t,template:i,pricing_room_id:$("#pricing_room_id").val(),pricing_checkin:$("#pricing_start_date").val(),pricing_checkout:$("#pricing_end_date").val(),pricing_guests:$("#pricing_guests").val(),pricing_price:$("#pricing_price").val()}).then(function(e){"false"!=e.data.success?($("#thread-list").prepend(e.data),$('[data-key="'+a+'"] textarea[name="message"]').val(""),$(".inquiry-form-fields").addClass("hide"),$('[data-tracking-section="accept"] ul').addClass("hide"),$('[data-tracking-section="decline"] ul').addClass("hide"),$('[data-tracking-section="discussion"] ul').addClass("hide")):("fail"==e.data.validator&&$('[data-key="'+a+'"] .ml-error').html("Message content must be filled!."),$('[data-error="price"]').html(e.data.msg))})},$(document).on("change","#month-dropdown",function(){var a=$(this).val(),t=a.split("-")[0],i=a.split("-")[1],n={};n.month=i,n.year=t,n.reservation_id=$("#reservation_id").val(),n.room_id=$("#hosting").val();var r=JSON.stringify(n);return $("#calendar-container").addClass("loading"),e.post(APP_URL+"/inbox/calendar",{data:r}).then(function(a){$("#calendar-container").removeClass("loading"),$("#calendar-container").html(a.data)}),!1}),$(document).on("click",".nextMonth, .previousMonth",function(){var a=$(this).attr("data-month"),t=$(this).attr("data-year"),i={};i.month=a,i.year=t,i.reservation_id=$("#reservation_id").val(),i.room_id=$("#hosting").val();var n=JSON.stringify(i);return $("#calendar-container").addClass("loading"),e.post(APP_URL+"/inbox/calendar",{data:n}).then(function(a){$("#calendar-container").removeClass("loading"),$("#calendar-container").html(a.data)}),!1}),$(document).on("click","#hosting",function(){var a={},t=$("#month-dropdown").val(),i=t.split("-")[0],n=t.split("-")[1];a.month=n,a.year=i,a.reservation_id=$("#reservation_id").val(),a.room_id=$(this).val();var r=JSON.stringify(a);return $("#calendar-container").addClass("loading"),e.post(APP_URL+"/inbox/calendar",{data:r}).then(function(a){$("#calendar-container").removeClass("loading"),$("#calendar-container").html(a.data)}),list_type=$("#edit_calendar_url").attr("data-type"),"Experiences"==list_type?$("#edit_calendar_url").attr("href",APP_URL+"/host/manage_experience/"+$(this).val()+"?step_num=1"):$("#edit_calendar_url").attr("href",APP_URL+"/manage-listing/"+$(this).val()+"/calendar"),!1}),$("#month-dropdown").val($("#month-dropdown_value").val()),$("#hosting").val($("#room_id").val()),$(document).on("click",".offer_attach",function(){$(".inquiry-form-fields").removeClass("hide"),$('[data-tracking-section="accept"] ul').removeClass("hide"),$('[data-tracking-section="accept"] input[name="template"][value=2]').prop("checked",!0);var a=$('[data-tracking-section="accept"] input[name="template"]:checked').parent().parent().parent().parent().data("key");$('[data-key="'+a+'"] .drawer').removeClass("hide")}),$(document).on("click",".pre_approve",function(){$(".inquiry-form-fields").removeClass("hide"),$('[data-tracking-section="accept"] ul').removeClass("hide"),$('[data-tracking-section="accept"] input[name="template"][value=1]').prop("checked",!0);var a=$('[data-tracking-section="accept"] input[name="template"]:checked').parent().parent().parent().parent().data("key");$('[data-key="'+a+'"] .drawer').removeClass("hide")}),$(document).on("click",".option-list a",function(){var a=$(this).parent().data("tracking-section");$("[data-tracking-section] ul").addClass("hide"),$('[data-tracking-section="'+a+'"] ul').removeClass("hide");var e=$('[data-tracking-section="'+a+'"] input[name="template"]:checked').parent().parent().parent().parent().data("key");$('[data-key="'+e+'"] .drawer').removeClass("hide")}),$(document).on("click",'input[name="template"]',function(){$("[data-key] .drawer").addClass("hide");var a=$(this).parent().parent().parent().parent().data("key");$('[data-key="'+a+'"] .drawer').removeClass("hide")}),setTimeout(function(){var a=$("#pricing_room_id").val();e.post("../../rooms/rooms_calendar",{data:a}).then(function(a){var e=(a.data.changed_price,a.data.not_available_checkin),n=a.data.not_available_checkout;$("#pricing_start_date").datepicker({minDate:0,dateFormat:datepicker_format,beforeShowDay:function(a){var a=jQuery.datepicker.formatDate("yy-mm-dd",a);return-1!=$.inArray(a,e)?[!1]:[!0]},onSelect:function(a,e){var i=e.selectedMonth+1,n=e.selectedDay+"-"+i+"-"+e.selectedYear;$('input[name="pricing[start_date]"]').val(n);var r=$("#pricing_end_date").datepicker("getDate"),s=$("#pricing_start_date").datepicker("getDate");if(s.setDate(s.getDate()+1),$("#pricing_end_date").datepicker("option","minDate",s),""==$("#pricing_end_date").val()||s>r){$("#pricing_end_date").datepicker("setDate",s);var d=s.getDate(),o=s.getMonth()+1,c=s.getFullYear(),l=d+"-"+o+"-"+c;$('input[name="pricing[end_date]"]').val(l),setTimeout(function(){$("#pricing_end_date").datepicker("show")},20)}var p=$('input[name="pricing[start_date]"]').val();t($('input[name="pricing[end_date]"]').val(),p,$("#pricing_guests").val(),$("#pricing_room_id").val()),a!=new Date&&$(".ui-datepicker-today").removeClass("ui-datepicker-today")}}),jQuery("#pricing_end_date").datepicker({minDate:1,dateFormat:datepicker_format,beforeShowDay:function(a){var a=jQuery.datepicker.formatDate("yy-mm-dd",a);return-1!=$.inArray(a,n)?[!1]:[!0]},onSelect:function(a,e){var i=e.selectedMonth+1,n=e.selectedDay+"-"+i+"-"+e.selectedYear;$('input[name="pricing[end_date]"]').val(n);var r=$("#pricing_start_date").datepicker("getDate"),s=$("#pricing_end_date").datepicker("getDate");if(s<=r&&""!=$("#pricing_start_date").val()){var d=$("#pricing_end_date").datepicker("option","minDate");$("#pricing_end_date").datepicker("setDate",d)}var r=$('input[name="pricing[start_date]"]').val(),s=$('input[name="pricing[end_date]"]').val(),o=$("#pricing_guests").val(),c=$("#pricing_room_id").val();""!=r&&t(s,r,o,c)}}),$("#pricing_room_id, #pricing_guests").change(function(){var a=$(this).val();""!=a&&i(a)})})},10)}]),$(document).on("contextmenu",'a[data-method="post"]',function(){return!1}),$(document).on("click",'a[data-method="post"]',function(){$('a[data-method="post"]').attr("disabled","disabled")});
