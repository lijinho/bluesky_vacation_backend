app.controller("wishlists",["$scope","$http","$filter",function(e,i,s){function t(i){var s={zoom:10,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("results_map"),s),"homes"==e.active_wishlist?o(map,i):a(map,i)}function a(e,i){var s,t,a=new google.maps.LatLngBounds,o=new google.maps.InfoWindow;for(t=0;t<i.length;t++){var n=i[t].host_experiences.title,r=i[t].host_experiences.host_experience_location.latitude,d=i[t].host_experiences.host_experience_location.longitude,_=i[t].host_experiences.photo_name,c=i[t].host_experiences.id,m=i[t].host_experiences.user_id,h=i[t].host_experiences.session_price,p=i[t].host_experiences.currency.symbol;latlngset=new google.maps.LatLng(r,d);var g='<div id="info_window_'+c+'" class="listing listing-map-popover" data-price="'+p+'" data-id="'+c+'" data-user="'+m+'" data-url="/experiences/'+c+'" data-name="'+n+'" data-lng="'+d+'" data-lat="'+r+'"><div class="panel-image listing-img">';g+='<a class="media-photo media-cover" target="listing_'+c+'" href="'+APP_URL+"/experiences/"+c+'"><div class="listing-img-container media-cover text-center"><img id="experience_marker_image_'+c+'" rooms_image = "" alt="'+n+'" class="img-responsive-height" data-current="0" src="'+_+'"></div></a>',g+='<div class="target-prev target-control block-link experience_marker_slider"  data-room_id="'+c+'"><i class="icon icon-chevron-left icon-size-2 icon-white"></i></div><a class="link-reset panel-overlay-bottom-left panel-overlay-label panel-overlay-listing-label" target="listing_'+c+'" href="'+APP_URL+"/experiences/"+c+'"><div>',g+='<sup class="h6 text-contrast">'+p+'</sup><span class="h3 text-contrast price-amount">'+h+'</span><sup class="h6 text-contrast"></sup></div></a><div class="target-next target-control experience_marker_slider block-link" data-room_id="'+c+'"><i class="icon icon-chevron-right icon-size-2 icon-white"></i></div></div>',g+='<div class="panel-body panel-card-section"><div class="media"><h3 class="h5 listing-name text-truncate row-space-top-1" itemprop="name" title="'+n+'">'+n+"</a></h3>";var s=new google.maps.Marker({map:e,title:g,position:latlngset,icon:l("normal")});a.extend(s.position),google.maps.event.addListener(s,"click",function(){o.setContent(this.title),o.open(e,this)})}var v=google.maps.event.addListener(e,"idle",function(){e.setZoom(3),e.fitBounds(a),google.maps.event.removeListener(v)})}function o(e,i){var s,t,a=new google.maps.LatLngBounds,o=new google.maps.InfoWindow;for(t=0;t<i.length;t++){var n=i[t].rooms.name,r=i[t].rooms.rooms_address.latitude,d=i[t].rooms.rooms_address.longitude,_=i[t].rooms.photo_name,c=i[t].room_id,m=i[t].address_url,h=i[t].rooms.user_id,p=i[t].rooms_price.night,g=i[t].rooms_price.currency.symbol,v=i[t].rooms.booking_type;latlngset=new google.maps.LatLng(r,d);var w='<div id="info_window_'+c+'" class="listing listing-map-popover" data-price="'+g+'" data-id="'+c+'" data-user="'+h+'" data-url="/'+m+"/"+c+'" data-name="'+n+'" data-lng="'+d+'" data-lat="'+r+'"><div class="panel-image listing-img">';w+='<a class="media-photo media-cover" target="listing_'+c+'" href="'+APP_URL+"/"+m+"/"+c+'"><div class="listing-img-container media-cover text-center"><img id="marker_image_'+c+'" rooms_image = "" alt="'+n+'" class="img-responsive-height" data-current="0" src="'+_+'"></div></a>',w+='<div class="target-prev target-control block-link marker_slider"  data-room_id="'+c+'"><i class="icon icon-chevron-left icon-size-2 icon-white"></i></div><a class="link-reset panel-overlay-bottom-left panel-overlay-label panel-overlay-listing-label" target="listing_'+c+'" href="'+APP_URL+"rooms/"+c+'"><div>',instant_book="","instant_book"==v&&(instant_book='<span aria-label="Book Instantly" data-behavior="tooltip" class="h3 icon-beach"><i class="icon icon-instant-book icon-flush-sides"></i></span>'),w+='<sup class="h6 text-contrast">'+g+'</sup><span class="h3 text-contrast price-amount">'+p+'</span><sup class="h6 text-contrast"></sup>'+instant_book+'</div></a><div class="target-next target-control marker_slider block-link" data-room_id="'+c+'"><i class="icon icon-chevron-right icon-size-2 icon-white"></i></div></div>',w+='<div class="panel-body panel-card-section"><div class="media"><h3 class="h5 listing-name text-truncate row-space-top-1" itemprop="name" title="'+n+'">'+n+"</a></h3>";var s=new google.maps.Marker({map:e,title:w,position:latlngset,icon:l("normal")});a.extend(s.position),google.maps.event.addListener(s,"click",function(){o.setContent(this.title),o.open(e,this)})}var u=google.maps.event.addListener(e,"idle",function(){e.setZoom(3),e.fitBounds(a),google.maps.event.removeListener(u)})}function l(e){var i="map-pin-set-3460214b477748232858bedae3955d81.png";return"hover"==e&&(i="hover-map-pin-set-3460214b477748232858bedae3955d81.png"),new google.maps.MarkerImage(APP_URL+"/images/"+i,new google.maps.Size(50,50),new google.maps.Point(0,0),new google.maps.Point(9,20))}e.wishlists_homes=[],e.wishlists_experience=[],e.common_loading=0,e.active_wishlist="homes",e.wishlist_count=0,e.get_wishlists_home=function(){$(".tab-btn").prop("disabled",!0),e.wishlists_homes=[],e.wishlists_experience=[],e.common_loading=1,i.post(APP_URL+"/get_wishlists_home",{id:$("#wl_id").val()}).then(function(i){i.data[0].all_rooms_count?($(".tab-btn").prop("disabled",!1),e.wishlists_homes=i.data[0].saved_wishlists,e.wishlist_count=i.data[0].saved_wishlists.length,e.common_loading=0):e.setwishlisttype("experience")})},e.get_wishlists_experience=function(){$(".tab-btn").prop("disabled",!0),e.wishlists_homes=[],e.wishlists_experience=[],e.common_loading=1,i.post(APP_URL+"/get_wishlists_experience",{id:$("#wl_id").val()}).then(function(i){$(".tab-btn").prop("disabled",!1),e.wishlists_experience=i.data[0].saved_wishlists,e.wishlist_count=i.data[0].saved_wishlists.length,e.common_loading=0})},e.setwishlisttype=function(i){"homes"==i?(e.get_wishlists_home(),e.get_map_home()):(e.get_wishlists_experience(),e.get_map_experience()),e.active_wishlist=i},e.delete_wishlist_home=function(s,t){var a=e.wishlists_homes[s].room_id,o="#noteloader_"+s;$(o).show(),i.post(APP_URL+"/remove_saved_wishlist/"+$("#wl_id").val(),{room_id:a}).then(function(i){i.data.length?(e.wishlist_count=i.data[0].rooms_count,t.splice(s,1)):(e.wishlist_count=0,e.wishlists_homes=[])})},e.delete_experience_home=function(s,t){var a=e.wishlists_experience[s].room_id,o="#noteloader_"+s;$(o).show(),i.post(APP_URL+"/remove_saved_wishlist/"+$("#wl_id").val(),{room_id:a}).then(function(i){i.data.length?(e.wishlist_count=i.data[0].host_experience_count,t.splice(s,1)):(e.wishlist_count=0,e.wishlists_experience=[])})},e.add_home_note=function(e,s){var t="#noteloader_"+s;$(t).show(),i.post(APP_URL+"/add_note_wishlist/"+$("#wl_id").val(),{room_id:e,note:$("#note_"+e).val()}).then(function(e){$(t).hide()})},e.get_wishlists_home(),e.get_map_home=function(){$("#results_map").addClass("loading"),i.post(APP_URL+"/get_wishlists_home",{id:$("#wl_id").val()}).then(function(e){t(e.data[0].saved_wishlists),$("#results_map").removeClass("loading")})},e.get_map_experience=function(){$("#results_map").addClass("loading"),i.post(APP_URL+"/get_wishlists_experience",{id:$("#wl_id").val()}).then(function(e){t(e.data[0].saved_wishlists),$("#results_map").removeClass("loading")})},$(".create").click(function(){$(".modal-transitions").removeClass("hide")}),$(".cancel").click(function(e){e.preventDefault(),$(".modal-transitions").addClass("hide"),e.preventDefault()}),$("#map").click(function(){$(".results-map").show(),$(".results-list").hide(),$("#map").prop("disabled",!0),$("#list").prop("disabled",!1),"homes"==e.active_wishlist?e.get_map_home():e.get_map_experience()}),$("#list").click(function(){$(".results-list").show(),$(".results-map").hide(),$("#list").prop("disabled",!0),$("#map").prop("disabled",!1)}),$(document).on("click",".experience_marker_slider",function(){var e=$(this).attr("data-room_id"),s=$("#experience_marker_image_"+e+",#experience_wishlist_image_"+e).attr("rooms_image"),t=$("#experience_marker_image_"+e+",#experience_wishlist_image_"+e).attr("src");if(""==$.trim(s))$(this).parent().addClass("loading"),i.post(APP_URL+"/host_experience_photos",{rooms_id:e}).then(function(i){angular.forEach(i.data,function(e){s=""==$.trim(s)?e.image_url:s+"^>"+e.image_url}),$("#experience_marker_image_"+e+",#experience_wishlist_image_"+e).attr("rooms_image",s);var a=s.split("^>"),o=a.length,l=0,n="";if(angular.forEach(a,function(e){$.trim(e)==$.trim(t)&&(n=l),l++}),1==$(this).is(".target-prev"))var r=n-1,d=o-1;else var r=n+1,d=0;if(void 0!==a[r]&&"null"!=$.trim(a[r]))var _=a[r];else var _=a[d];var c=_;$(".panel-image").removeClass("loading"),$(".listing_slideshow_thumb_view").removeClass("loading"),$("#experience_marker_image_"+e+",#experience_wishlist_image_"+e).attr("src",c)});else{$(this).parent().addClass("loading");var a=s.split("^>"),o=a.length,l=0,n="";if(angular.forEach(a,function(e){$.trim(e)==$.trim(t)&&(n=l),l++}),1==$(this).is(".target-prev"))var r=n-1,d=o-1;else var r=n+1,d=0;if(void 0!==a[r]&&"null"!=$.trim(a[r]))var _=a[r];else var _=a[d];var c=_;$(".panel-image").removeClass("loading"),$(".listing_slideshow_thumb_view").removeClass("loading"),$("#experience_marker_image_"+e+",#experience_wishlist_image_"+e).attr("src",c)}}),$(document).on("click",".marker_slider",function(){var e=$(this).attr("data-room_id"),s=$("#marker_image_"+e+",#wishlist_image_"+e).attr("rooms_image"),t=$("#marker_image_"+e+",#wishlist_image_"+e).attr("src");if(""==$.trim(s))$(this).parent().addClass("loading"),i.post(APP_URL+"/rooms_photos",{rooms_id:e}).then(function(i){angular.forEach(i.data,function(e){s=""==$.trim(s)?e.name:s+"^>"+e.name}),$("#marker_image_"+e+",#wishlist_image_"+e).attr("rooms_image",s);var a=s.split("^>"),o=a.length,l=0,n="";if(angular.forEach(a,function(e){$.trim(e)==$.trim(t)&&(n=l),l++}),1==$(this).is(".target-prev"))var r=n-1,d=o-1;else var r=n+1,d=0;if(void 0!==a[r]&&"null"!=$.trim(a[r]))var _=a[r];else var _=a[d];var c=_;$(".panel-image").removeClass("loading"),$(".listing_slideshow_thumb_view").removeClass("loading"),$("#marker_image_"+e+",#wishlist_image_"+e).attr("src",c)});else{$(this).parent().addClass("loading");var a=s.split("^>"),o=a.length,l=0,n="";if(angular.forEach(a,function(e){$.trim(e)==$.trim(t)&&(n=l),l++}),1==$(this).is(".target-prev"))var r=n-1,d=o-1;else var r=n+1,d=0;if(void 0!==a[r]&&"null"!=$.trim(a[r]))var _=a[r];else var _=a[d];var c=_;$(".panel-image").removeClass("loading"),$(".listing_slideshow_thumb_view").removeClass("loading"),$("#marker_image_"+e+",#wishlist_image_"+e).attr("src",c)}}),$(".edit-button").click(function(){$(".show_view").hide(),$(".edit_view").show()}),$(".edit_view .cancel").click(function(){$(".show_view").show(),$(".edit_view").hide()}),$(".edit_view .delete").click(function(){confirm("Are you sure?")&&(window.location.href=APP_URL+"/delete_wishlist/"+wishlist_id)}),$(".share-envelope-btn").click(function(){$(".modal-container").show()}),$(".modal-close").click(function(){$(".modal-container").hide()}),$('[id^="wishlist-widget-icon-"]').click(function(){if("object"==typeof USER_ID)return window.location.href=APP_URL+"/login",!1;var s=$(this).data("name"),t=$(this).data("img"),a=$(this).data("address"),o=$(this).data("host_img");e.room_id=$(this).data("room_id"),$(".background-listing-img").css("background-image","url("+t+")"),$(".host-profile-img").attr("src",o),$(".wl-modal-listing__name").text(s),$(".wl-modal-listing__address").text(a),$(".wl-modal-footer__input").val(a),$(".wl-modal__modal").removeClass("hide"),$(".wl-modal__col:nth-child(2)").addClass("hide"),$(".row-margin-zero").append('<div id="wish-list-signup-container" style="overflow-y:auto;" class="col-lg-5 wl-modal__col-collapsible"> <div class="loading wl-modal__col"> </div> </div>'),i.get(APP_URL+"/wishlist_list?id="+$(this).data("room_id"),{}).then(function(i){$("#wish-list-signup-container").remove(),$(".wl-modal__col:nth-child(2)").removeClass("hide"),e.wishlist_list=i.data})}),e.wishlist_row_select=function(s){i.post(APP_URL+"/save_wishlist",{data:e.room_id,wishlist_id:e.wishlist_list[s].id,saved_id:e.wishlist_list[s].saved_id}).then(function(i){"null"==i.data?e.wishlist_list[s].saved_id=null:e.wishlist_list[s].saved_id=i.data}),$("#wishlist_row_"+s).hasClass("text-dark-gray")?e.wishlist_list[s].saved_id=null:e.wishlist_list[s].saved_id=1},$(document).on("submit",".wl-modal-footer__form",function(s){s.preventDefault(),$(".wl-modal__col:nth-child(2)").addClass("hide"),$(".row-margin-zero").append('<div id="wish-list-signup-container" style="overflow-y:auto;" class="col-lg-5 wl-modal__col-collapsible"> <div class="loading wl-modal__col"> </div> </div>'),i.post(APP_URL+"/wishlist_create",{data:$(".wl-modal-footer__input").val(),id:e.room_id}).then(function(i){$(".wl-modal-footer__form").addClass("hide"),$("#wish-list-signup-container").remove(),$(".wl-modal__col:nth-child(2)").removeClass("hide"),e.wishlist_list=i.data,s.preventDefault()}),s.preventDefault()}),$(".wl-modal__modal-close").click(function(){s("filter")(e.wishlist_list,{saved_id:null}).length==e.wishlist_list.length?$("#wishlist-widget-"+e.room_id).prop("checked",!1):$("#wishlist-widget-"+e.room_id).prop("checked",!0),$(".wl-modal__modal").addClass("hide"),$(".wl-modal__modal").show()})}]);
